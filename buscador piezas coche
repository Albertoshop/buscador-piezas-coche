<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador de Piezas de Coche</title>
    <!-- Incluye Tailwind CSS para un dise√±o moderno y responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Estilos personalizados para la tipograf√≠a Inter */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7; /* Fondo gris claro */
        }
        /* Estilo para el bot√≥n principal */
        .primary-button {
            transition: all 0.2s;
        }
        .primary-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }
    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex items-start justify-center">

    <div id="app" class="w-full max-w-lg bg-white p-6 md:p-8 rounded-xl shadow-2xl space-y-6">

        <!-- T√≠tulo y Descripci√≥n -->
        <header class="text-center space-y-2">
            <h1 class="text-3xl font-bold text-gray-800">üõ†Ô∏è Buscador de Piezas PRO</h1>
            <p class="text-sm text-gray-500">Encuentra la pieza exacta y su mejor precio online.</p>
        </header>

        <!-- Formulario de B√∫squeda -->
        <section class="space-y-5">
            <!-- Selector de Modelo -->
            <div class="space-y-2">
                <label for="car-model" class="block text-sm font-medium text-gray-700">Paso 1: Selecciona el Modelo de Coche</label>
                <select id="car-model" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 shadow-sm transition duration-150 ease-in-out bg-white text-gray-900">
                    <option value="" disabled selected>Selecciona un modelo...</option>
                </select>
            </div>

            <!-- Selector de Pieza -->
            <div class="space-y-2">
                <label for="car-part" class="block text-sm font-medium text-gray-700">Paso 2: Selecciona la Pieza a Buscar</label>
                <select id="car-part" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500 shadow-sm transition duration-150 ease-in-out bg-gray-100 text-gray-500" disabled>
                    <option value="" disabled selected>Selecciona un modelo primero...</option>
                </select>
            </div>

            <!-- Bot√≥n de B√∫squeda y Afiliaci√≥n -->
            <button id="search-button" class="primary-button w-full flex items-center justify-center p-3 text-lg font-semibold text-white bg-red-600 rounded-lg shadow-md hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed" disabled>
                Buscar Mejor Precio en Amazon üöÄ
            </button>
        </section>

        <!-- √Årea de Resultados y Mensajes -->
        <div id="message-area" class="text-center text-sm p-4 rounded-lg hidden">
            <!-- Los mensajes se mostrar√°n aqu√≠ -->
        </div>
    </div>

    <script>
        // === ZONA DE CONFIGURACI√ìN Y DATOS ===
        
        // Tu ID de Afiliado de Amazon
        const AFFILIATE_TAG = "dimetu-21"; 

        // ------------------------------------------------------------------
        // ** INICIO DE LA BASE DE DATOS DE VEH√çCULOS (CAR_DATABASE) **
        // ------------------------------------------------------------------
        const CAR_DATABASE = {
            
            // -- Modelos EL√âCTRICOS (NUEVOS) --
            "BYD Atto 3 (2022-Actual)": {
                "Alfombrillas a Medida (TPE)": "Alfombrillas goma TPE BYD Atto 3",
                "Protector de Pantalla Central": "Protector pantalla navegaci√≥n BYD Atto 3",
                "Filtro de Polen/Habit√°culo": "Filtro habit√°culo carbon BYD Atto 3"
            },
            "BYD Seal (2023-Actual)": {
                "Parasol Retr√°ctil Techo": "Parasol techo panoramico BYD Seal",
                "Cable de Carga Tipo 2 (Monof√°sico)": "Cable de carga Tipo 2 7.4kW BYD Seal",
                "Escobillas Limpiaparabrisas": "Escobillas limpiaparabrisas BYD Seal"
            },
            "BYD Dolphin (2023-Actual)": {
                "Organizador de Maletero": "Organizador maletero coche BYD Dolphin",
                "Embellecedores Interiores": "Accesorios interiores BYD Dolphin",
                "Pastillas de Freno Delanteras": "Pastillas de freno delanteras BYD Dolphin"
            },
            "Ebro (Gama El√©ctrica/H√≠brida)": {
                "Cable de Carga Tipo 2 (7m)": "Cable carga coche electrico Tipo 2 22kW para SUV",
                "Cargador de Pared (Wallbox)": "Wallbox 7.4kW trifasico Ebro",
                "Filtro de Aire de Cabina": "Filtro de habit√°culo Ebro EV",
                "Funda para Cargador Exterior": "Funda protectora cargador EV exterior"
            },
            "Tesla Model 3/Y (2017-Actual)": {
                "Alfombrillas de Goma Premium": "Alfombrillas Tesla Model 3 TPE",
                "Cable de Carga Tipo 2 (7m)": "Cable carga coche electrico Tipo 2 22kW",
                "Filtro de Aire de Cabina HEPA": "Filtro de cabina HEPA Tesla Model Y"
            },
            "Volkswagen ID.4 (2020-Actual)": {
                "Tapacubos de Rueda (Juego 4)": "Tapacubos Volkswagen ID.4 19 pulgadas",
                "Cargador Port√°til (Schuko)": "Cargador portatil coche electrico schuko 3.6kW",
                "Escobillas Limpiaparabrisas": "Escobillas limpiaparabrisas VW ID.4"
            },
            "Hyundai Kona El√©ctrico (2018-Actual)": {
                "Protector de Pantalla Central": "Protector pantalla Hyundai Kona electrico",
                "Filtro de Polen/Habit√°culo": "Filtro aire Hyundai Kona electrico",
                "Pastillas de Freno Traseras": "Pastillas freno traseras Hyundai Kona EV"
            },

            // -- Modelos de COMBUSTI√ìN (Anteriores) --
            "Seat Ibiza (2017-2023)": {
                "Escobillas Limpiaparabrisas (Juego)": "Seat Ibiza 6F escobillas limpiaparabrisas",
                "Aceite de Motor 5W30 (5 Litros)": "Aceite motor 5W30 VW 504 00 Seat Ibiza",
            },
            "Toyota Corolla (2018-2023)": {
                "Filtro de Aceite": "Toyota Corolla filtro aceite 2020",
                "Pastillas de Freno Delanteras": "Pastillas freno Toyota Corolla 2018",
                "Bater√≠a": "Bateria coche AGM 70Ah Toyota Corolla"
            },
            "Volkswagen Golf VII (2012-2020)": {
                "Buj√≠as (Juego de 4)": "Bujias NGK Volkswagen Golf VII",
                "Amortiguadores Traseros": "Amortiguadores Bilstein Golf 7"
            },
            "Ford Focus (2019-Actual)": {
                "Limpiaparabrisas (Juego)": "Escobillas limpiaparabrisas Ford Focus 2019"
            },
            "Renault Clio IV (2012-2019)": {
                "Filtro de Aire": "Filtro aire motor Renault Clio 4 1.5 dCi",
                "Kit de Distribuci√≥n": "Kit distribucion Renault Clio IV 1.2 16V",
                "Bombillas H7": "Bombillas H7 homologadas Renault Clio 4"
            },
            "BMW Serie 3 E46 (1998-2006)": {
                "Juego de Alfombrillas": "Alfombrillas BMW E46 a medida",
                "Sensor de Posici√≥n del Cig√ºe√±al": "Sensor cigue√±al BMW E46 M54",
                "Discos de Freno Delanteros": "Discos freno ventilados BMW E46"
            },
            "Fiat 500 (2007-Actual)": {
                "Funda para Asientos": "Funda asientos Fiat 500 dise√±o",
                "Filtro de Polen/Habit√°culo": "Filtro habitaculo carbon activo Fiat 500",
                "Tapacubos (Juego de 4)": "Tapacubos 14 pulgadas Fiat 500"
            }
        };
        // ------------------------------------------------------------------
        // ** FIN DE LA BASE DE DATOS DE VEH√çCULOS **
        // ------------------------------------------------------------------


        // === ELEMENTOS DEL DOM (Definidos aqu√≠, asignados en initApp) ===
        let modelSelect, partSelect, searchButton, messageArea;

        // === FUNCIONES PRINCIPALES ===

        /**
         * Muestra o esconde mensajes de usuario.
         * @param {boolean} show - Si se debe mostrar el mensaje.
         * @param {string} text - El contenido del mensaje.
         * @param {string} type - 'success', 'error' o 'info' para estilos.
         */
        function showMessage(show, text = '', type = 'info') {
            if (!messageArea) return; 

            messageArea.innerHTML = text;
            if (show) {
                messageArea.classList.remove('hidden', 'bg-red-100', 'bg-green-100', 'text-red-700', 'text-green-700', 'bg-blue-100', 'text-blue-700');
                if (type === 'error') {
                    messageArea.classList.add('bg-red-100', 'text-red-700');
                } else if (type === 'success') {
                    messageArea.classList.add('bg-green-100', 'text-green-700');
                } else {
                    messageArea.classList.add('bg-blue-100', 'text-blue-700');
                }
            } else {
                messageArea.classList.add('hidden');
            }
        }


        /**
         * Inicializa los selectores con los datos de la base de datos.
         */
        function initializeSelectors() {
            // Rellenar el selector de Modelos
            Object.keys(CAR_DATABASE).forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                modelSelect.appendChild(option);
            });
        }

        /**
         * Maneja el cambio del modelo de coche seleccionado.
         * Rellena el selector de piezas basado en el modelo elegido.
         */
        function handleModelChange() {
            const selectedModel = modelSelect.value;
            
            // Limpiar y resetear el selector de piezas
            partSelect.innerHTML = '<option value="" disabled selected>Selecciona la pieza...</option>';
            partSelect.disabled = true;
            searchButton.disabled = true;
            showMessage(false);

            if (selectedModel) {
                const parts = CAR_DATABASE[selectedModel];
                
                // Rellenar el selector de Piezas
                Object.keys(parts).forEach(partName => {
                    const option = document.createElement('option');
                    option.value = parts[partName]; // Usamos la referencia/b√∫squeda como valor
                    option.textContent = partName;
                    partSelect.appendChild(option);
                });

                // Habilitar el selector de piezas
                partSelect.disabled = false;
                partSelect.classList.remove('bg-gray-100', 'text-gray-500');
                partSelect.classList.add('bg-white', 'text-gray-900');
            }
        }

        /**
         * Maneja el cambio de la pieza seleccionada.
         * Habilita/Deshabilita el bot√≥n de b√∫squeda.
         */
        function handlePartChange() {
            const selectedPart = partSelect.value;
            // Habilitar el bot√≥n solo si tanto el modelo como la pieza est√°n seleccionados
            searchButton.disabled = !(modelSelect.value && selectedPart);
            showMessage(false);
        }
        
        /**
         * Construye el enlace de afiliado y redirecciona.
         */
        function redirectToAmazon() {
            // El valor de la pieza seleccionada es la frase de b√∫squeda precisa.
            const productSearchQuery = partSelect.value; 

            if (!productSearchQuery) {
                showMessage(true, 'Error: Selecciona el modelo y la pieza antes de buscar.', 'error');
                return;
            }

            // Construye el enlace de b√∫squeda de Amazon con tu Tag de Afiliado
            // Utilizamos el endpoint de b√∫squeda (s?k=)
            const amazonUrl = `https://www.amazon.es/s?k=${encodeURIComponent(productSearchQuery)}&tag=${AFFILIATE_TAG}`;

            // 1. Muestra un mensaje al usuario antes de redirigir (UX)
            showMessage(true, `Redireccionando a Amazon para buscar: "${productSearchQuery}"...`, 'success');
            
            // 2. Redirecciona al usuario
            setTimeout(() => {
                // Abre el enlace en una nueva pesta√±a
                window.open(amazonUrl, '_blank');
                
                // Mensaje post-redirecci√≥n
                showMessage(true, '¬°Redirecci√≥n completada! Revisa la nueva pesta√±a para ver los resultados de Amazon.', 'info');
            }, 800); 

            console.log("URL generada con afiliado:", amazonUrl);
        }


        /**
         * Funci√≥n principal de inicializaci√≥n que se ejecuta cuando el DOM est√° listo.
         */
        function initApp() {
            // 1. Asignar los elementos DOM (¬°Garantiza que existen!)
            modelSelect = document.getElementById('car-model');
            partSelect = document.getElementById('car-part');
            searchButton = document.getElementById('search-button');
            messageArea = document.getElementById('message-area');

            // 2. Inicializar los selectores
            initializeSelectors();

            // 3. Establecer Event Listeners
            modelSelect.addEventListener('change', handleModelChange);
            partSelect.addEventListener('change', handlePartChange);
            searchButton.addEventListener('click', redirectToAmazon);

            // 4. Mensaje de inicio para el usuario
            showMessage(true, 'Bienvenido. Por favor, selecciona el modelo y la pieza para empezar.', 'info');
        }

        // === EJECUCI√ìN INICIAL: Aseguramos que la funci√≥n initApp se ejecuta solo cuando el DOM est√© completamente cargado ===
        document.addEventListener('DOMContentLoaded', initApp);

    </script>
</body>
</html>
